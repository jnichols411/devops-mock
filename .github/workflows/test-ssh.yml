name: Test SSH to VM

on:
  workflow_dispatch:

jobs:
  ssh-test:
    runs-on: ubuntu-latest

    steps:
    - name: Set up SSH key
      run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.MOCK_DEV_PRIVATE_KEY }}" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        ssh-keyscan -H ${{ secrets.MOCK_DEV_IP_ADDRESS }} >> ~/.ssh/known_hosts

    - name: Debug SSH key and known_hosts
      run: |
        echo "Private key length: $(wc -c < ~/.ssh/id_rsa)"
        ls -la ~/.ssh  # Debugging: check permissions and key location
        cat ~/.ssh/known_hosts  # Debugging: check known_hosts file

    - name: Test SSH connection
      run: |
        ssh -i ~/.ssh/id_rsa -p 22 deploy@${{ secrets.MOCK_DEV_IP_ADDRESS }} "echo 'Connected! Creating test folder...'; mkdir -p ~/github-action-test && echo 'âœ… Done.'"
