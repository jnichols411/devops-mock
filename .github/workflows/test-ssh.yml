jobs:
  ssh-test:
    runs-on: [self-hosted]
    steps:
      - name: Set up SSH key (Windows syntax)
        shell: powershell
        run: |
          $sshDir = "$env:USERPROFILE\.ssh"
          if (!(Test-Path -Path $sshDir)) {
            New-Item -ItemType Directory -Path $sshDir
          }
          Set-Content -Path "$sshDir\id_rsa" -Value "${{ secrets.MOCK_DEV_PRIVATE_KEY }}"
          icacls "$sshDir\id_rsa" /inheritance:r /grant:r "$($env:USERNAME):(R)"
          
          ssh-keyscan -p 2222 -H ${{ secrets.MOCK_DEV_IP_ADDRESS }} | Out-File -Encoding ascii -Append "$sshDir\known_hosts"

      - name: Test SSH connection
        shell: powershell
        run: |
          $sshDir = "$env:USERPROFILE\.ssh"
          ssh -i "$sshDir\id_rsa" -p 2222 ${{ secrets.MOCK_DEV_USERNAME }}@${{ secrets.MOCK_DEV_IP_ADDRESS }} "echo 'Connected! Creating test folder...'; mkdir -p ~/github-action-test && echo 'âœ… Done.'"
